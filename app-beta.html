<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mi Cuenta | Conecta 360¬∞</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <style>
        :root {
            /* --- PALETA CONECTA 360 --- */
            --brand-primary: #FF9900;
            --brand-accent: #9ECA57;
            --brand-dark: #111111;
            --bg-light: #F4F4F4;
            --white: #FFFFFF;
            --sidebar-width: 280px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background-color: var(--bg-light); 
            color: var(--brand-dark); 
            min-height: 100vh; 
            display: block; 
            overflow-x: hidden; 
            overflow-y: auto;   
        }

        /* --- PANTALLA DE CARGA --- */
        #loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--white); z-index: 5000;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .spinner {
            border: 4px solid #f3f3f3; border-top: 4px solid var(--brand-primary);
            border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 15px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- LOGIN SCREEN --- */
        #login-view {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, var(--brand-primary) 0%, var(--brand-dark) 100%);
            display: none; justify-content: center; align-items: center; z-index: 2000; padding: 20px;
        }
        .login-card {
            background: var(--white); padding: 40px 30px; border-radius: 25px; width: 100%; max-width: 400px;
            text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .form-group { margin-bottom: 20px; text-align: left; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 700; font-size: 0.85rem; color: #444; }
        .form-input { 
            width: 100%; padding: 16px; border: 2px solid #eee; border-radius: 12px; 
            font-family: 'Montserrat', sans-serif; transition: 0.3s; font-size: 1rem;
        }
        .form-input:focus { border-color: var(--brand-primary); outline: none; }

        /* --- SIDEBAR --- */
        .sidebar {
            width: var(--sidebar-width); background: var(--white); height: 100vh;
            border-right: 1px solid rgba(0,0,0,0.05); display: flex; flex-direction: column; padding: 30px;
            position: fixed; top: 0; left: 0; z-index: 100;
        }
        .brand {
            display: flex; align-items: center; gap: 15px; margin-bottom: 50px;
            color: var(--brand-primary); font-weight: 900; font-size: 1.2rem;
        }
        .nav-menu { list-style: none; flex: 1; }
        .nav-link {
            display: flex; align-items: center; gap: 15px; padding: 14px 20px;
            text-decoration: none; color: #666; font-weight: 600;
            border-radius: 12px; transition: all 0.2s; font-size: 0.95rem; margin-bottom: 8px;
        }
        .nav-link:hover, .nav-link.active { background: #fff8eb; color: var(--brand-primary); }
        .user-mini-profile {
            margin-top: auto; display: flex; align-items: center; gap: 12px;
            padding-top: 20px; border-top: 1px solid #eee; cursor: pointer;
        }
        .avatar {
            width: 45px; height: 45px; background: var(--brand-dark); color: white;
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-weight: 800; font-size: 1rem;
        }

        /* --- MAIN CONTENT --- */
        .main-content {
            margin-left: var(--sidebar-width); padding: 40px; 
            width: calc(100% - var(--sidebar-width)); min-height: 100vh;
        }
        #app-view { display: none; width: 100%; }

        .section-view { display: none; animation: fadeIn 0.4s ease; }
        .section-view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h2 { font-size: 2rem; font-weight: 800; margin-bottom: 5px; color: var(--brand-dark); }
        .subtitle { color: #888; margin-bottom: 30px; font-size: 1rem; }

        /* --- CARDS & GRID --- */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-bottom: 40px; }
        .card { background: var(--white); border-radius: 20px; padding: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.04); border: 1px solid rgba(0,0,0,0.02); }
        .card-label { color: #888; font-size: 0.85rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; display: block; margin-bottom: 10px; }
        .card-value { font-size: 2rem; font-weight: 900; color: var(--brand-dark); }
        .highlight-text { color: var(--brand-primary); }
        .badge-active { background: #eafbe4; color: #5a8a25; padding: 5px 12px; border-radius: 50px; font-weight: 800; font-size: 0.75rem; border: 1px solid #cce8c2; }

        /* --- PLANES DETALLADOS --- */
        .plans-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; }
        .plan-card { 
            background: white; border: 2px solid #eee; border-radius: 20px; padding: 30px; 
            text-align: center; transition: 0.3s; display: flex; flex-direction: column; 
            position: relative; overflow: hidden;
        }
        .plan-card.active-plan { border: 2px solid var(--brand-accent); background: #f9fff6; }
        
        .plan-name { font-size: 1.4rem; font-weight: 800; margin-bottom: 5px; display: block; color: var(--brand-dark); }
        .plan-ideal { font-size: 0.85rem; color: #888; font-style: italic; margin-bottom: 15px; min-height: 40px; }
        
        .plan-price { font-size: 1.8rem; font-weight: 900; color: var(--brand-primary); margin: 10px 0; }
        .plan-saving { background: #111; color: #fff; display: inline-block; padding: 4px 10px; border-radius: 4px; font-size: 0.7rem; font-weight: 700; margin-bottom: 20px; }

        .plan-features { list-style: none; margin-bottom: 25px; text-align: left; font-size: 0.9rem; color: #555; flex: 1; }
        .plan-features li { margin-bottom: 12px; display: flex; gap: 10px; line-height: 1.4; }
        .plan-features li i { color: var(--brand-accent); margin-top: 3px; }

        /* --- BUTTONS --- */
        .btn-primary { 
            background: var(--brand-accent); color: var(--brand-dark);
            border: none; padding: 15px; border-radius: 12px; font-weight: 800; cursor: pointer; width: 100%; font-size: 1rem; 
            transition: 0.2s;
        }
        .btn-secondary { background: var(--brand-dark); color: white; border: none; padding: 12px; border-radius: 50px; font-weight: 600; cursor: pointer; font-size: 0.85rem; width: 100%; margin-top: auto; }
        
        .alert-box { padding: 15px; border-radius: 12px; margin-bottom: 20px; display: none; text-align: center; font-weight: 600; font-size: 0.9rem; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }

        /* --- RESPONSIVE --- */
        .mobile-nav { display: none; }
        @media (max-width: 768px) {
            .sidebar { display: none; } 
            .main-content { margin-left: 0; width: 100%; padding: 20px; padding-bottom: 100px; }
            h2 { font-size: 1.8rem; }
            .mobile-nav {
                display: flex; position: fixed; bottom: 0; left: 0; width: 100%;
                background: rgba(255, 255, 255, 0.98); border-top: 1px solid #eee; z-index: 1000;
                justify-content: space-around; padding: 12px 0;
                box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
            }
            .mobile-link {
                text-decoration: none; color: #999; text-align: center; font-size: 0.7rem;
                display: flex; flex-direction: column; align-items: center; gap: 5px; flex: 1;
            }
            .mobile-link i { font-size: 1.4rem; margin-bottom: 2px; }
            .mobile-link.active { color: var(--brand-primary); font-weight: 700; }
            .dashboard-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="spinner"></div>
        <p style="font-weight: 600; color: #666;">Cargando...</p>
    </div>

    <div id="login-view">
        <div class="login-card">
            <img src="img/conecta.png" alt="Conecta 360" style="width: 150px; margin-bottom: 25px;">
            <p style="color: #666; margin-bottom: 30px; font-weight: 600;">Acceso Miembros</p>
            <form id="loginForm">
                <div class="form-group"><label>Email</label><input type="email" class="form-input" required></div>
                <div class="form-group"><label>Contrase√±a</label><input type="password" class="form-input" required></div>
                <button type="submit" class="btn-primary">Ingresar</button>
            </form>
        </div>
    </div>

    <div id="app-view">
        <aside class="sidebar">
            <div class="brand">
                <img src="img/conecta.png" alt="Conecta 360" style="height: 50px; width: auto;">
            </div>
            <ul class="nav-menu">
                <li class="nav-item"><a href="#" class="nav-link active" onclick="navTo('dashboard', this)"><i class="fas fa-home"></i> <span>Resumen</span></a></li>
                <li class="nav-item"><a href="#" class="nav-link" onclick="navTo('planes', this)"><i class="fas fa-star"></i> <span>Planes</span></a></li>
                <li class="nav-item"><a href="#" class="nav-link" onclick="navTo('perfil', this)"><i class="fas fa-user-cog"></i> <span>Mis Datos</span></a></li>
            </ul>
            <div class="user-mini-profile" onclick="logout()">
                <div class="avatar">MH</div>
                <div>
                    <div style="font-weight: 700; font-size: 0.9rem;">Mi Perfil</div>
                    <div style="font-size: 0.75rem; color: #888;">Cerrar Sesi√≥n</div>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div id="dashboard" class="section-view active">
                <h2>Hola, <span class="highlight-text" id="user-name-display">Cargando...</span> üëã</h2>
                <p class="subtitle">Resumen de tu actividad.</p>
                <div class="dashboard-grid">
                    <div class="card">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                            <div><span class="card-label">PLAN ACTUAL</span><div class="card-value highlight-text" id="current-plan-name" style="font-size:1.5rem;">...</div></div>
                            <span class="badge-active">ACTIVO</span>
                        </div>
                        <ul style="list-style:none; color:#666; font-size:0.9rem;" id="dashboard-features-list"></ul>
                    </div>
                    <div class="card">
                        <span class="card-label">PR√ìXIMO COBRO</span>
                        <div class="card-value">05 Nov</div>
                        <p style="margin:5px 0 20px 0; color:#666; font-size:0.9rem;">Monto: <strong id="payment-amount">...</strong></p>
                        <button onclick="navTo('planes')" class="btn-primary">Ver Detalles del Plan</button>
                    </div>
                </div>
            </div>

            <div id="planes" class="section-view">
                <h2>Planes y Beneficios</h2>
                <p class="subtitle">Descubre todo lo que incluye cada nivel de Conecta 360¬∞.</p>
                
                <div class="plans-grid" id="plans-container-render"></div>
            </div>

            <div id="perfil" class="section-view">
                <h2>Mis Datos</h2>
                <p class="subtitle">Ajustes personales y seguridad.</p>
                <div class="dashboard-grid">
                    <div class="card">
                        <h3 style="margin-bottom: 20px; font-size: 1.1rem;">Informaci√≥n</h3>
                        <div id="profile-alert" class="alert-box alert-success">Guardado correctamente.</div>
                        <form onsubmit="updateProfile(event)">
                            <div class="form-group"><label>Nombre del Proyecto</label><input type="text" id="input-name" class="form-input" disabled style="background:#f5f5f5; color:#888;"></div>
                            <div class="form-group"><label>Email</label><input type="email" id="input-email" class="form-input" disabled style="background:#f5f5f5; color:#888;"></div>
                            <div class="form-group"><label>Tel√©fono</label><input type="tel" id="input-phone" class="form-input"></div>
                            <button type="submit" class="btn-secondary">Guardar Cambios</button>
                        </form>
                    </div>
                   <div class="card">
    <h3 style="margin-bottom: 20px; font-size: 1.1rem;">Seguridad</h3>
    
    <div id="pass-success" class="alert-box alert-success" style="display:none;">¬°Contrase√±a actualizada con √©xito!</div>
    <div id="pass-error" class="alert-box alert-error" style="display:none;">Error: Verifica tu contrase√±a actual.</div>

    <form onsubmit="changePassword(event)">
        <div class="form-group">
            <label>Contrase√±a Actual</label>
            <input type="password" id="current-pass" class="form-input" placeholder="Para verificar que eres t√∫" required>
        </div>

        <div class="form-group">
            <label>Nueva Contrase√±a</label>
            <input type="password" id="new-pass" class="form-input" placeholder="M√≠nimo 6 caracteres" required>
        </div>

        <div class="form-group">
            <label>Repetir Nueva Contrase√±a</label>
            <input type="password" id="confirm-pass" class="form-input" required>
        </div>

        <button type="submit" id="btn-change-pass" class="btn-primary">Actualizar Contrase√±a</button>
    </form>
</div>
                </div>
            </div>
        </main>

        <nav class="mobile-nav">
            <a href="#" class="mobile-link active" onclick="navTo('dashboard', this)"><i class="fas fa-home"></i><span>Inicio</span></a>
            <a href="#" class="mobile-link" onclick="navTo('planes', this)"><i class="fas fa-star"></i><span>Planes</span></a>
            <a href="#" class="mobile-link" onclick="navTo('perfil', this)"><i class="fas fa-user-circle"></i><span>Perfil</span></a>
        </nav>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <script>
        // --- 1. CONFIGURACI√ìN FIREBASE (REEMPLAZA CON TUS DATOS) ---
        const firebaseConfig = {
           apiKey: "AIzaSyBve-f9-BAlYHdgLx0NLjwMK8z5l8C8yW4",
  authDomain: "conecta360-c0259.firebaseapp.com",
  projectId: "conecta360-c0259",
  storageBucket: "conecta360-c0259.firebasestorage.app",
  messagingSenderId: "614768909024",
  appId: "1:614768909024:web:2bb1dc4cc5ecd3efe54e85"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // --- 2. DATOS COMPLETOS DE LOS PLANES (Fuente: pulsart-crear.js) ---
        const plansData = {
            basico: {
                name: 'üü° Plan B√°sico',
                price: '350.000',
                idealFor: 'Para artistas en etapa de exploraci√≥n.',
                saving: '770.000 Gs',
                features: [
                    '1 asesor√≠a de orientaci√≥n de venta/imagen semestral (Valor real: 400.000 Gs)',
                    '1 sesi√≥n fotogr√°fica de estudio - 50 fotos (Valor real: 500.000 Gs)',
                    '2 horas de Estudio de grabaci√≥n (Valor real: 220.000 Gs)',
                    '10% de descuento en talleres y servicios adicionales'
                ]
            },
            desarrollo: {
                name: 'üü† Plan Desarrollo',
                price: '550.000',
                idealFor: 'Para artistas que buscan desarrollar y lanzar su propuesta.',
                saving: '2.380.000 Gs',
                features: [
                    '1 asesor√≠a de orientaci√≥n de venta/imagen semestral (Valor real: 600.000 Gs)',
                    'Registro de obras - hasta 2 expedientes/trimestre (Valor real: 1.000.000 Gs)',
                    '3 horas de Estudio de grabaci√≥n (Valor real: 330.000 Gs)',
                    '1 asesor√≠a sobre redes sociales e identidad visual (Valor real: 1.000.000 Gs)',
                    '15% de descuento en talleres y servicios seleccionados'
                ]
            },
            pro: {
                name: 'üî¥ Plan Pro',
                price: '950.000',
                idealFor: 'Para profesionales que buscan consolidar su carrera.',
                saving: '3.490.000 Gs',
                features: [
                    'Asesor√≠a integral trimestral + seguimiento mensual (Valor real: 1.000.000 Gs)',
                    'Registro de hasta 3 expedientes mensuales (Valor real: 1.500.000 Gs)',
                    '1 Sesi√≥n fotogr√°fica y creaci√≥n de contenido trimestral (Valor real: 1.000.000 Gs)',
                    '4 horas de Estudio de grabaci√≥n (Valor real: 440.000 Gs)',
                    'Asesor√≠a y gesti√≥n para distribuci√≥n en plataformas',
                    'Acceso gratuito a networking y co-creaci√≥n'
                ]
            },
            premium: {
                name: '‚ö´ Plan Premium',
                price: '1.500.000',
                idealFor: 'Para proyectos con actividad constante y listos para seguir.',
                saving: '8.080.000 Gs',
                features: [
                    'Asesor√≠a integral trimestral + acompa√±amiento semanal (Valor real: 1.500.000 Gs)',
                    'Registro de hasta 4 expedientes mensuales (Valor real: 1.700.000 Gs)',
                    'Uso de estudio/espacio creativo: 2 horas semanales (Valor real: 880.000 Gs)',
                    'Sesi√≥n audiovisual completa y fotos para campa√±a (Valor real: 3.500.000 Gs)',
                    'Asesor√≠a permanente de redes y distribuci√≥n digital',
                    'Participaci√≥n prioritaria en eventos'
                ]
            }
        };

        let currentUserDoc = null;

        // --- L√ìGICA DE CARGA Y AUTENTICACI√ìN ---
        auth.onAuthStateChanged((user) => {
            if (user) {
                if(currentUserDoc && currentUserDoc.uid === user.uid) return;
                loadUserData(user.uid);
            } else {
                hideLoading();
                document.getElementById('login-view').style.display = 'flex';
                document.getElementById('app-view').style.display = 'none';
            }
        });

        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = e.target.querySelector('input[type="email"]').value;
            const pass = e.target.querySelector('input[type="password"]').value;
            showLoading();
            auth.signInWithEmailAndPassword(email, pass).catch((error) => {
                hideLoading();
                alert("Error: " + error.message);
            });
        });

        function loadUserData(uid) {
            db.collection("usuarios").doc(uid).get().then((doc) => {
                if (doc.exists) {
                    currentUserDoc = doc.data();
                    currentUserDoc.uid = uid;
                    initAppUI();
                    hideLoading();
                    document.getElementById('login-view').style.display = 'none';
                    document.getElementById('app-view').style.display = window.innerWidth <= 768 ? 'block' : 'flex';
                } else {
                    hideLoading();
                    alert("Usuario no encontrado en la base de datos.");
                    auth.signOut();
                }
            }).catch(error => { hideLoading(); alert("Error de conexi√≥n"); });
        }

        // --- RENDERIZADO DE INTERFAZ ---
        function initAppUI() {
            document.getElementById('user-name-display').innerText = currentUserDoc.nombre || "Artista";
            document.getElementById('input-name').value = currentUserDoc.nombre || "";
            document.getElementById('input-email').value = currentUserDoc.email || "";
            document.getElementById('input-phone').value = currentUserDoc.telefono || "";
            updateDashboardUI();
            renderPlansUI();
        }

        function updateDashboardUI() {
            const planKey = currentUserDoc.plan_actual || 'basico';
            const current = plansData[planKey];
            
            document.getElementById('current-plan-name').innerText = current.name;
            document.getElementById('payment-amount').innerText = `Gs. ${current.price}`;
            
            // En el dashboard solo mostramos los primeros 3 beneficios para resumir
            const list = document.getElementById('dashboard-features-list');
            list.innerHTML = '';
            current.features.slice(0, 3).forEach(f => {
                // Limpiamos el texto de "(Valor real...)" para el dashboard para que entre bien
                const cleanText = f.split('(')[0]; 
                list.innerHTML += `<li><i class="fas fa-check"></i> ${cleanText}</li>`;
            });
            if(current.features.length > 3) {
                list.innerHTML += `<li style="color:var(--brand-primary); font-weight:600; font-size:0.8rem;">+ ${current.features.length - 3} beneficios m√°s...</li>`;
            }
        }

        function renderPlansUI() {
            const container = document.getElementById('plans-container-render');
            container.innerHTML = '';
            const userPlan = currentUserDoc.plan_actual || 'basico';

            Object.keys(plansData).forEach(key => {
                const p = plansData[key];
                const isActive = key === userPlan;
                
                let btnHtml = isActive 
                    ? `<button class="btn-secondary" style="background:var(--brand-accent); color:var(--brand-dark); pointer-events:none; opacity:0.8;">Tu Plan Actual</button>`
                    : `<button class="btn-secondary" onclick="changePlan('${key}')">Elegir este Plan</button>`;

                container.innerHTML += `
                    <div class="plan-card ${isActive ? 'active-plan' : ''}">
                        <span class="plan-name">${p.name}</span>
                        <p class="plan-ideal">${p.idealFor}</p>
                        
                        <div class="plan-price">Gs. ${p.price}</div>
                        <div class="plan-saving"><i class="fas fa-piggy-bank"></i> Ahorras ${p.saving}/mes</div>
                        
                        <ul class="plan-features">
                            ${p.features.map(f => `<li><i class="fas fa-check-circle"></i> ${f}</li>`).join('')}
                        </ul>
                        ${btnHtml}
                    </div>
                `;
            });
        }

        // --- ACCIONES ---
        function changePlan(newPlanKey) {
            if(confirm(`¬øDeseas cambiarte al ${plansData[newPlanKey].name}?`)) {
                showLoading();
                db.collection("usuarios").doc(auth.currentUser.uid).update({ plan_actual: newPlanKey })
                .then(() => {
                    currentUserDoc.plan_actual = newPlanKey;
                    updateDashboardUI(); renderPlansUI(); navTo('dashboard');
                    hideLoading(); alert("¬°Plan actualizado! Disfruta tus nuevos beneficios.");
                });
            }
        }

        function updateProfile(e) {
            e.preventDefault();
            const newPhone = document.getElementById('input-phone').value;
            db.collection("usuarios").doc(auth.currentUser.uid).update({ telefono: newPhone })
            .then(() => {
                const a = document.getElementById('profile-alert'); a.style.display='block'; setTimeout(()=>a.style.display='none',3000);
            });
        }

// Funci√≥n para cambiar contrase√±a con Re-autenticaci√≥n
function changePassword(e) {
    e.preventDefault();

    const currentPass = document.getElementById('current-pass').value;
    const newPass = document.getElementById('new-pass').value;
    const confirmPass = document.getElementById('confirm-pass').value;
    const btn = document.getElementById('btn-change-pass');
    
    // Elementos de alerta
    const successBox = document.getElementById('pass-success');
    const errorBox = document.getElementById('pass-error');
    
    // Limpiar alertas previas
    successBox.style.display = 'none';
    errorBox.style.display = 'none';

    // 1. Validaciones b√°sicas
    if (newPass.length < 6) {
        alert("La nueva contrase√±a debe tener al menos 6 caracteres.");
        return;
    }
    if (newPass !== confirmPass) {
        alert("Las contrase√±as nuevas no coinciden.");
        return;
    }
    if (currentPass === newPass) {
        alert("La nueva contrase√±a no puede ser igual a la actual.");
        return;
    }

    // Bloquear bot√≥n
    const originalText = btn.innerText;
    btn.innerText = "Verificando...";
    btn.disabled = true;
    btn.style.opacity = "0.7";

    const user = auth.currentUser;
    
    // 2. Crear credencial con la contrase√±a ACTUAL para re-autenticar
    const credential = firebase.auth.EmailAuthProvider.credential(user.email, currentPass);

    // 3. Re-autenticar y luego actualizar
    user.reauthenticateWithCredential(credential).then(() => {
        // Si la contrase√±a actual es correcta, procedemos al cambio
        btn.innerText = "Actualizando...";
        return user.updatePassword(newPass);
    }).then(() => {
        // ¬°√âxito!
        successBox.style.display = 'block';
        document.getElementById('current-pass').value = "";
        document.getElementById('new-pass').value = "";
        document.getElementById('confirm-pass').value = "";
        
        btn.innerText = originalText;
        btn.disabled = false;
        btn.style.opacity = "1";
        
        // Ocultar mensaje de √©xito despu√©s de 4 seg
        setTimeout(() => { successBox.style.display = 'none'; }, 4000);

    }).catch((error) => {
        // Error (probablemente contrase√±a actual incorrecta)
        console.error("Error al cambiar contrase√±a:", error);
        
        if(error.code === 'auth/wrong-password') {
            errorBox.innerText = "La contrase√±a actual es incorrecta.";
        } else {
            errorBox.innerText = "Error: " + error.message;
        }
        errorBox.style.display = 'block';
        
        btn.innerText = originalText;
        btn.disabled = false;
        btn.style.opacity = "1";
    });
}

        function navTo(sectionId, element) {
            document.querySelectorAll('.section-view').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            if(element && element.classList.contains('nav-link')) element.classList.add('active');
            document.querySelectorAll('.mobile-link').forEach(l => l.classList.remove('active'));
            const ids = ['dashboard', 'planes', 'perfil'];
            const index = ids.indexOf(sectionId);
            if(index !== -1 && document.querySelectorAll('.mobile-link')[index]) document.querySelectorAll('.mobile-link')[index].classList.add('active');
            if(document.querySelector('.main-content')) document.querySelector('.main-content').scrollTop = 0;
        }

        function showLoading() { document.getElementById('loading-screen').style.display = 'flex'; }
        function hideLoading() { document.getElementById('loading-screen').style.display = 'none'; }
        function logout() { if(confirm("¬øCerrar sesi√≥n?")) { showLoading(); auth.signOut().then(() => location.reload()); } }
    </script>
</body>
</html>